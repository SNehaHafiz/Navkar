@{
    ViewBag.Title = "OtherWorkOrder";
    Layout = "~/Views/Shared/_LayoutDashboard.cshtml";
}
<script src="~/js/GetTableJson.js"></script>
<div class=" content-area" id="divWorkOrder">
    <div class="page-header">
        <h4 class="page-title">Generate Other Work Order</h4>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a onclick="BackToWorkOrderSummary();" class="btn btn-primary btn-success text-right" style="align-content:center;color:white"><i class="fa fa-file-text" data-placement="bottom" title="Open Work Order Summary"></i> </a>
            </li>
        </ol>
    </div>
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="form-horizontal">
                        <div class="row">
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">WO No</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("txtWONo", null, new { @class = "form-control", @id = "txtWONo", name = "txtWONo", disabled = "disabled", autocomplete = "off", placeholder = "NEW", @Value = ViewBag.WONO })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12 col-lg-3">
                                <div class="form-group label-floating">
                                    <label class="form-label mandatory">WO Date</label>
                                    @Html.TextBox("txtWODate", null, new { @class = "form-control  form_datetime1 ", @id = "txtWODate", name = "txtWODate", Value = DateTime.Now.ToString("dd MMM yyyy HH:mm"), autocomplete = "off", @maxlength = 100 })
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">Place Name</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("txtName", null, new { @class = "form-control", @id = "txtName", name = "txtName", autocomplete = "off", placeholder = "Place Name", @Value = "" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">Assing By</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("txtAssignBy", null, new { @class = "form-control", @id = "txtAssignBy", name = "txtAssignBy", autocomplete = "off", placeholder = "Assign By", @Value = "" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">Vendor Name</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.DropDownList("ddlVendor", (IEnumerable<SelectListItem>)ViewBag.VendorList, "--Select--", new { @class = "form-control", @id = "ddlVendor", name = "ddlVendor", autocomplete = "off" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">Date</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("txtDate", null, new { @class = "form-control form_datetime1", @id = "txtDate", name = "txtDate", autocomplete = "off", placeholder = "Date", Value = DateTime.Now.ToString("dd MMM yyyy HH:mm") })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">Weight (MT)</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("txtWeight", null, new { @class = "form-control", @id = "txtWeight", name = "txtWeight", autocomplete = "off", placeholder = "Weight", @Value = "" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-3 col-sm-3" style="margin-top:20px;">
                                <div class="form-group">
                                    <button id="btnsave" class="btn btn-success btn-xs" onclick="Save()">Save</button>
                                    <input type="button" name="clearProfile" value="Clear" class="btn cursor" title="clear" id="clearValue" onclick="Clear()" />
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
            </div>
        </div>
    </div>
</div>
<div class=" content-area" id="divOpenWorkOrderSummary" style="display:none">
    <div class="page-header">
        <h4 class="page-title">List of Other Work Orders </h4>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a onclick="BackToWorkOrder();" class="btn btn-primary btn-success text-right" style="align-content:center;color:white"><i class="fa fa-arrow-left" data-placement="bottom" title="Add Work Order"></i> </a>
            </li>
        </ol>
    </div>
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="form-horizontal">
                        <div class="row">
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label"> From Date</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("txtFromDate", null, new { @class = "form-control form_datetime1", @Value = DateTime.Now.AddDays(-7).ToString("dd MMM yyyy HH:mm") })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label"> To Date</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("txtToDate", null, new { @class = "form-control form_datetime1", @Value = DateTime.Now.ToString("dd MMM yyyy HH:mm") })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label"> Vendor</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.DropDownList("ddlVendorL", (IEnumerable<SelectListItem>)ViewBag.VendorList, "ALL", new { @class = "form-control custom-select", @id = "ddlVendorL", name = "ddlVendorL", autocomplete = "off" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-2 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label" style="visibility:hidden"> '</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            <input type="button" value="Show" class="btn btn-primary" onclick="ShowOtherSummary()" />
                                            <button class=" btn btn-primary" id="btnPrint" onclick="PrintWO()" type="button">
                                                Print
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12 col-sm-12">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover tbl-cart text-nowrap" id="tblWorkOrderOpenList" style="width:100%;">
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th></th>
                                                <th class="wd-15p sorting">Sr No</th>
                                                <th class="wd-15p sorting">Work Order No</th>
                                                <th class="wd-15p sorting">Work Order Date</th>
                                                <th class="wd-15p sorting">Name</th>
                                                <th class="wd-15p sorting">Assign By</th>
                                                <th class="wd-15p sorting">Date</th>
                                                <th class="wd-15p sorting">Weight</th>
                                            </tr>
                                        </thead>                                        
                                    </table>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
</div>
    <script>
        function Save() {

            if ($("#txtWODate").val() == "") {
                alert("Work Order Date cannot be Blank.");
                return;
            }

            if ($("#txtName").val() == "") {
                alert("Name cannot be Blank.");
                return;
            }

            if ($("#txtAssignBy").val() == "") {
                alert("Assing By cannot be Blank.");
                return;
            }

            if ($("#txtDate").val() == "") {
                alert("Date cannot be Blank.");
                return;
            }

            if ($("#txtWeight").val() == "") {
                alert("Work Order Date cannot be Blank.");
                return;
            }

            if ($("#ddlVendor").val() == "") {
                alert("Please select Vendor Name.");
                return;
            }

            var data1 = { 'WONo': $("#txtWONo").val(), 'WODate': $("#txtWODate").val(), 'Name': $("#txtName").val(), 'AssignBy': $("#txtAssignBy").val(), 'Date': $("#txtDate").val(), 'Weight': $("#txtWeight").val(), 'VendorName': $("#ddlVendor").val() };

                var data = JSON.stringify(data1);

                $.ajax({
                    url: "/WorkOrder/OtherWorkOrderSave",
                    data: data,
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (response) {
                        
                        if (response == "1") {
                            alert("Record saved successfully");
                            window.location = "/workOrder/OtherWorkOrder";
                        }
                        else {
                            alert("Record not saved successfully. Try Again!");
                            $("#btnsave").removeAttr('disabled');
                        }
                    },
                    error: function (errormessage) {
                        alert("error");
                        alert(errormessage.responseText);
                    }
                })
         }
            
        function ShowOtherSummary() {

            var data1 = { 'FromDate': $("#txtFromDate").val(), 'ToDate': $("#txtToDate").val(), 'Vendor': $("#ddlVendorL").val() };

            var data = JSON.stringify(data1);

            $.ajax({
                url: "/WorkOrder/ViewOpenWOrkOrder",
                data: data,
                type: "POST",
                contentType: "application/json; charset=utf-8",
                // dataType: "json",
                success: function (data) {
                    RepTableDataJson($("#tblWorkOrderOpenList"), data, "OtherWorkOrder", "OtherWorkOrderList");
                },

                error: function (errormessage) {
                    alert(errormessage.responseText);
                }
            });
        }

        function BackToWorkOrder() {
            $("#divOpenWorkOrderSummary").hide();
            $("#divWorkOrder").show();
        }

        function BackToWorkOrderSummary() {
            $("#divWorkOrder").hide();
            $("#divOpenWorkOrderSummary").show();
        }

        function PrintWO() {
            var data1 = { 'FromDate': $("#txtFromDate").val(), 'ToDate': $("#txtToDate").val(), 'Vendor': $("#ddlVendorL").val() };

            var data = JSON.stringify(data1);

            $.ajax({
                url: "/WorkOrder/OtherWorkReportPrint",
                data: data,
                type: "POST",
                contentType: "application/json; charset=utf-8",
                // dataType: "json",
                success: function (response) {
                    var myWindow = window.open("", "MsgWindow1");
                    myWindow.close();
                    var myWindow = window.open("", "MsgWindow1");
                    myWindow.document.write(response);
                },

                error: function (errormessage) {
                    alert(errormessage.responseText);
                }
            });

        }

    </script>
