
@{
    ViewBag.Title = "Pump Acknowledgement";
    Layout = "~/Views/Shared/_LayoutDashboard.cshtml";
}

<style>
    .table thead th, .text-wrap table thead th {
        background-color: #9f78ff;
        color: white;
    }
</style>
<script src="~/js/GetTableJsonwopaging.js"></script>
<div id="tracker-loader"></div>
<div class=" content-area" id="diventrysummary">
    <div class="page-header">
        <h4 class="page-title">Pump Acknowledgement</h4>
        <div class="form-group">
            <label class="form-label"></label>
            <div class="row gutters-xs">
                <div class="col">

                    <button type="button" class="btn btn-icon btn-teal" name="summarylist" title="Summary list" id="summarylist" onclick="ViewSummary();"><i class="fa fa-file-text"></i></button>


                </div>
            </div>
        </div>

    </div>
    <div class="row">
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-sm-12 col-lg-12">

                        <div class="row">
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">Trailer No(Last 4 digits)</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("txtTrailerno", null, new { @class = "form-control", @id = "Trailerno", name = "Trailerno", autocomplete = "off", placeholder = "Trailer No", @maxlength = 4 })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-sm-12" id="divtrailernodrop">
                                <label class="form-label">Trailer No </label>
                                <select id="ddlTrailerNo" class="form-control">
                                    <option value="">--Select--</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">Slip No</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("TxtSLipNo", null, new { @class = "form-control", @id = "TxtSLipNo", @name = "TxtSLipNo", autocomplete = "off" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-1 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory" style="visibility:hidden">No</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            <button class="btn btn-primary btn-xs" id="btnSaveDriver" onclick="GetSlipNodetails();"><i class="fa fa-search"></i></button>

                                        </div>
                                    </div>
                                </div>
                            </div>


                        </div>
                        <div class="row">
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">Driver Name</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("ddldrivername", null, new { @class = "form-control", @id = "ddldrivername", @name = "ddldrivername", autocomplete = "off", @readonly = true })

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">Slip Date</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("TxtSLipdate", null, new { @class = "form-control", @id = "TxtSLipdate", @name = "TxtSLipdate", autocomplete = "off", @readonly = true })
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-2 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">Fuel Qty</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("TxtFuelQty", null, new { @class = "form-control", @id = "TxtFuelQty", @name = "TxtFuelQty", autocomplete = "off", @readonly = true })
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-2 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">Fuel Rate</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("TxtFuelRate", null, new { @class = "form-control", @id = "TxtFuelRate", @name = "TxtFuelRate", autocomplete = "off", @readonly = true })

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-2 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">Total Amount</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("TxtTotalAmt", null, new { @class = "form-control", @id = "TxtTotalAmt", @name = "TxtTotalAmt", autocomplete = "off", @readonly = true })
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">Remarks</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextArea("TxtRemarks", null, new { @class = "form-control", @id = "TxtRemarks", @name = "TxtRemarks", autocomplete = "off" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-2 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory" style="visibility:hidden">No</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            <button class="btn btn-success btn-xs" id="btnSaveDriver" onclick="SaveDetailsForFuel();">Acknowledge </button>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory" style="visibility:hidden">No</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            <button class="btn btn-gray btn-xs" id="btnSaveDriver" onclick="Clear();">Clear </button>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
</div>



<div class=" content-area" id="divView" style="display:none">
    <div class="page-header">
        <h4 class="page-title">Pump Acknowledgement summary</h4>
        <div class="ibox-content  text-right">
            <a onclick="getBack();" class="btn btn-primary btn-success" style="color:white;align-content:center;"><i class="fa fa-arrow-left" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Back"></i>  </a></li>
        </div>

    </div>
    <div class="row">
        <div class="col-md-12 col-lg-12">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-lg-2 col-sm-12">
                            <div class="form-group">
                                <label class="form-label">From Date</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        @Html.TextBox("FromDate", null, new { @class = "form-control form_datetime1", @Value = DateTime.Now.AddDays(-1).ToString("dd MMM yyyy 08:00") })

                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="col-lg-2 col-sm-12">
                            <div class="form-group">
                                <label class="form-label"> To Date</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        @Html.TextBox("ToDate", null, new { @class = "form-control form_datetime1", @Value = DateTime.Now.ToString("dd MMM yyyy 07:59") })

                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="col-lg-1 col-sm-12">
                            <div class="form-group">
                                <label class="form-label" style="visibility:hidden">.</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        <button class="btn btn-primary" id="btnSearch" type="button" onclick="ShowFuelAcknowledgement()"><i class="fe fe-search"></i></button>

                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>

                    <div class="row">
                        <div class="col-md-12 col-lg-12">
                            <button class="btn btn-orange" id="btnSearch" type="button"><i class="fa fa-file-excel-o" onclick="GetExcelFile()"></i></button>

                            <table class="table table-bordered table-hover tbl-cart text-nowrap" id="example2">
                                <thead>
                                    <tr></tr>
                                </thead>

                            </table>

                        </div>
                    </div>
                    </div>
            </div>
        </div>
    </div>
</div>




<script  type="text/javascript">
    $(document).ready(function () {

        $('#example1').dataTable({
            "bLengthChange": false,
            "bInfo": false,
            "bPaginate": false,
            "bFilter": true,
            "paging": false
        });
    })
    $(document).ready(function () {
        $("#tracker-loader").fadeOut("slow");
    });
</script>

<script>
    function Clear() {
        document.location = '@Url.Action("PumpAcknowledgement", "loadingplan")'
    }

    function ViewSummary() {
        $("#diventrysummary").hide();
        $("#divView").show();
    }

    function getBack() {
        $("#diventrysummary").show();
        $("#divView").hide();
    }
</script>

<script>
    function GetSlipNodetails() {
        $("#tracker-loader").fadeIn("slow");

        var res = validateFunction();
        if (res == false) {
            $("#tracker-loader").fadeOut("slow");
            return false;
        }
       
        var Trailerid = $("#ddlTrailerNo option:selected").val()
        var SLipNo = $("#TxtSLipNo").val()
        

       
            $.ajax({
                type: 'POST',
                url: '/loadingplan/GetSLipnowiseFuel',
                data: '{Trailerid: ' + JSON.stringify(Trailerid) + ', SLipNo: ' + JSON.stringify(SLipNo) + '}',

                contentType: "application/json; charset=utf-8",
                dataType: "json",

                success: function (data) {

                    $("#TxtFuelQty").val(data.Fuelqty);
                    $("#ddldrivername").val(data.DriverName);
                    $("#TxtSLipdate").val(data.SLipdate);
                    $("#TxtFuelRate").val(data.Fuelrate);
                    $("#TxtTotalAmt").val(data.totalamount);
                 

                  
                    $("#tracker-loader").fadeOut("slow");
                },
                error: function (error) {
                    let str = error.responseText;
                    var a = str.indexOf("<title>") + 7;
                    var b = str.indexOf("</title>");
                    str = str.substring(a, b);
                    alert("Something went wrong: " + str);
                    $("#tracker-loader").fadeOut("slow");
                }
            });
        
    }

    
</script>
<script>
    function validateFunction() {

        var Trailerid = document.getElementById('ddlTrailerNo').value;

        var Slipno = document.getElementById('TxtSLipNo').value;
       


        document.getElementById("ddlTrailerNo").style.borderColor = "gainsboro";
        document.getElementById("TxtSLipNo").style.borderColor = "gainsboro";
     

        var blResult = Boolean;
        blResult = true;


        if (Trailerid == "") {
            //  document.getElementById('ContainerNo').style.borderColor = "red"
            document.getElementById("ddlTrailerNo").style.borderColor = "red";
            blResult = blResult && false;
        }
        if (Slipno == "") {
            //  document.getElementById('ContainerNo').style.borderColor = "red"
            document.getElementById("TxtSLipNo").style.borderColor = "red";
            blResult = blResult && false;
        }

        

        
       
        if (blResult == false) { alert('Please fill the required fields!'); }
        return blResult;

    };
    $('#Trailerno').change(function (e) {
        var trailerno = $("#Trailerno").val();
        $.ajax({
            url: "/ManualPortOut/AjaxGetTrailerNo",
            data: '{trailerno: ' + JSON.stringify(trailerno) + '}',
            type: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {

                var select = $("#ddlTrailerNo");

                select.empty();
                select.append($('<option/>', {
                    value: "",
                    text: "--Select--"
                }));

                $.each(data, function (data, value) {

                    select.append($("<option></option>").val(value.trailerid).html(value.trailername));
                })

             



            },

            error: function (error) {
                let str = error.responseText;
                var a = str.indexOf("<title>") + 7;
                var b = str.indexOf("</title>");
                str = str.substring(a, b);
                alert("Something went wrong: " + str);
            }
        });




    });


    function SaveDetailsForFuel() {
        var Trailerid = $("#ddlTrailerNo option:selected").val()
        var SLipNo = $("#TxtSLipNo").val()
        var FuelQty = $("#TxtFuelQty").val()
        var FuelRate = $("#TxtFuelRate").val()
        var Totalamt = $("#TxtTotalAmt").val()
        var Remarks = $("#TxtRemarks").val()

        var data1 = { 'Trailerid': Trailerid, 'SLipNo': SLipNo, 'FuelQty': FuelQty, 'FuelRate': FuelRate, 'Totalamt': Totalamt, 'Remarks': Remarks }
        var data = JSON.stringify(data1);

        $.ajax({
            type: 'POST',
            url: '/loadingplan/SaveFuelAcknowledgement',
            data: data,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {

                alert(data);
                if (data == 'Record saved successfully') {
                   
                    Clear();
                    $("#tracker-loader").fadeOut("slow");

                } else {
                    $("#tracker-loader").fadeOut("slow");
                }

              
            },
            error: function (error) {
                let str = error.responseText;
                var a = str.indexOf("<title>") + 7;
                var b = str.indexOf("</title>");
                str = str.substring(a, b);
                alert("Something went wrong: " + str);
                $("#tracker-loader").fadeOut("slow");
            }
        });
    }


    function ShowFuelAcknowledgement() {
        var fromdate = $("#FromDate").val();
        var Todate = $("#ToDate").val();

        data1 = { 'FromDate': fromdate, 'ToDate': Todate };
        data = JSON.stringify(data1);


        $.ajax({
            type: 'POST',
            url: '/LoadingPlan/AjaxGetFuelAcknowledgement',
            data: data,
            // data: "",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            async: true,
            success: function (jsonResult) {
                $("#example2").empty();
                RepTableDataJsonwopaging($("#example2"), jsonResult, "Voucher Details", "VoucherDetails_List");
                $("#tracker-loader").fadeOut("slow");
            },
            error: function (error) {
                let str = error.responseText;
                var a = str.indexOf("<title>") + 7;
                var b = str.indexOf("</title>");
                str = str.substring(a, b);
                alert("Something went wrong: " + str);
                $("#tracker-loader").fadeOut("slow");
            }
        });

    }


    function GetExcelFile() {
           window.location = '@Url.Action("ExportToExcelFuelAcknowledgement", "LoadingPlan")?';
    }
</script>