
@{
    ViewBag.Title = "New Container IN";
    Layout = "~/Views/Shared/_LayoutDashboard.cshtml";
}
<script src="~/js/GetTableJson.js"></script>

<div id="AddNewContainerIN">
    <div class="page-header">
        <h4 class="page-title">New Container IN</h4>
        <div class="form-group">
            <label class="form-label"></label>
            <div class="row gutters-xs">
                <div class="col">
                    <button type="button" class="btn btn-icon btn-teal" name="summarylist" title="Summary list" id="summarylist" onclick="ViewSummary();"><i class="fa fa-file-text"></i></button>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12 col-lg-12">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-lg-3 col-sm-12" style="display:none">
                            <div class="form-group">
                                <label class="form-label mandatory">IN ID</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        @Html.TextBox("txtMasterID", null, new { @class = "form-control ", @id = "txtMasterID", name = "txtMasterID", autocomplete = "off" })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-sm-12" style="display:none">
                            <div class="form-group">
                                <label class="form-label mandatory">IN Date</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        @Html.TextBox("txtInDT", null, new { @class = "form-control form_datetime1", @id = "txtInDT", name = "txtInDT", autocomplete = "on", @Value = DateTime.Now.ToString("dd MMM yyyy hh:mm") })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-2 col-sm-12">
                            <div class="form-group">
                                <label class="form-label mandatory">Date</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        @Html.TextBox("txtPurchaseDT", null, new { @class = "form-control datePickerD", @id = "txtPurchaseDT", name = "txtPurchaseDT", autocomplete = "off", @Value = DateTime.Now.ToString("dd MMM yyyy") })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-2 col-sm-12">
                            <div class="form-group">
                                <label class="form-label mandatory">Container No</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        @Html.TextBox("txtContainerNo", null, new { @class = "form-control ", @id = "txtContainerNo", name = "txtContainerNo", autocomplete = "off", @style = "text-transform:uppercase", @maxlength = 11, placeholder = "Container No", })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-2 col-sm-12">
                            <div class="form-group">
                                <label class="form-label mandatory">Size</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        @Html.DropDownList("ddlSize", new List<SelectListItem>
                                        { new SelectListItem { Text = "--Select--", Value = ""},
                                        new SelectListItem { Text = "20", Value = "20"},
                                        new SelectListItem { Text = "40", Value = "40"},
                                        new SelectListItem { Text = "45", Value = "45"},
                                          }, new { @class = "form-control", autocomplete = "off", @id = "ddlSize" })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-2 col-sm-12">
                            <div class="form-group">
                                <label class="form-label mandatory">Type</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        @Html.DropDownList("ddlType", new List<SelectListItem>
                                        { new SelectListItem { Text = "--Select--", Value = ""},
                                        new SelectListItem { Text = "GEN", Value = "GEN"},
                                        new SelectListItem { Text = "REF", Value = "REF"},
                                        new SelectListItem { Text = "TK", Value = "TK"},
                                          }, new { @class = "form-control", autocomplete = "off", @id = "ddlType" })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-sm-12">
                            <div class="form-group">
                                <label class="form-label mandatory">Vendor Name</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        @Html.TextBox("txtVendorName", null, new { @class = "form-control ", @id = "txtVendorName", name = "txtVendorName", autocomplete = "off", placeholder = "Vendor Name" })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-12 col-sm-12">
                            <div class="form-group">
                                <label class="form-label mandatory">Remarks</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        @Html.TextArea("txtRemarks", null, new { @class = "form-control ", @id = "txtRemarks", name = "txtRemarks", autocomplete = "off", placeholder = "Remarks", })
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="card-footer">
                    <button id="btnClear" class="btn btn-default btn-xs float-left" data-toggle="tooltip" data-placement="bottom" data-original-title="Clear" onclick="reload();" value="Clear"><i class="fa fa-refresh"></i></button>
                    <button id="btnSave" class="btn btn-success btn-xs float-right" data-toggle="tooltip" data-placement="bottom" data-original-title="Save" onclick="SaveNewContainerIN();"><i class="fa fa-floppy-o"></i></button>
                    @*<input type="button" name="clear" value="Clear" class="btn btn-default float-right" title="clear" id="clearValue" />*@
                </div>
            </div>
        </div>
    </div>
</div>
<div id="ContainerINsummaryList" style="display:none">
    <div class="page-header">
        <h4 class="page-title"><i class="fa fa-arrow-left" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Back" onclick="AddNewCotainerIN()"></i> New Container IN Summary <label class="bg-primary text-white br-7 pl-3 pr-3" id="quotCount"></label></h4>
    </div>
    <div class="row">
        <div class="col-lg-12 col-sm-12">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-lg-2 col-sm-12">
                            <div class="form-group">
                                <label class="form-label">From Date</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        @Html.TextBox("TxtFromdate", null, new { @class = "form-control form_datetime1", @id = "TxtFromdate", name = "TxtFromdate", autocomplete = "on", @Value = DateTime.Now.ToString("dd MMM yyyy hh:mm") })
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="col-lg-2 col-sm-12">
                            <div class="form-group">
                                <label class="form-label">To Date</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        @Html.TextBox("TxtFromdate", null, new { @class = "form-control form_datetime1", @id = "TxtTodate", name = "TxtTodate", autocomplete = "on", @Value = DateTime.Now.ToString("dd MMM yyyy hh:mm") })
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="col-lg-2 col-sm-12">
                            <div class="form-group">
                                <label class="form-label" style="visibility:hidden">.</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        <button type="button" class="btn btn-icon btn-primary" name="clearProfile" title="Show" id="btnShow" onclick="GetSummarydetails()"><i class="fa fa-search"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12 col-lg-12">
                            <div id="btnExcel" title="Export To Excel" type="button"></div>
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover text-nowrap" id="tblContainerSummary" style="width:100%">
                                    <thead class="bg-primary">
                                        <tr>
                                            <th class="text-white">Date</th>
                                            @*<th class="text-white">Dept Name</th>*@
                                            <th class="text-white">Container No</th>
                                            <th class="text-white">Size</th>
                                            <th class="text-white">Type</th>
                                            <th class="text-white">Vendor Name</th>
                                            <th class="text-white">Remarks</th>
                                            <th class="text-white">Added On</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    var d = new Date();
    var currMonth = d.getMonth();
    var currYear = d.getFullYear();
    var currHour = d.getHours();
    var currMin = d.getMinutes();
    var startDate = new Date(currYear, currMonth, 1);

    $(document).ready(function () {

        $('#TxtFromdate').datepicker({
            //startDate: startDate,
            format: 'dd M yyyy 00:00',
        });
        $('#TxtFromdate').datepicker("setDate", startDate);

        GetSummarydetails();
    });

    function InputToUpper(obj) {
        if (obj.value != "") {
            obj.value = obj.value.toUpperCase();
        }
    }

</script>

<script>

    function ViewSummary() {
        $("#AddNewContainerIN").hide()
        $('#ContainerINsummaryList').show()
    }

    function AddNewCotainerIN() {
        $("#AddNewContainerIN").show()
        $('#ContainerINsummaryList').hide()
    }
</script>

<script>

    function reload() {
        var Url = "/DomesticInventoryManagement/ContainerIN";
        document.location = Url;
    }

    var SummaryList = [];
    function GetSummarydetails() {

        var isValid = true;
        var Type = 'Purchase';
        var FromDate = $("#TxtFromdate").val();
        var ToDate = $("#TxtTodate").val();

        if (FromDate == "" || ToDate == "") {
            alert("Please Select date range");
            return false;
        }
        var date1 = new Date(FromDate);
        var date2 = new Date(ToDate);
        var Today = new Date();
        if (date1 >= date2) {
            document.getElementById('TxtTodate').style.borderColor = "red";

            alert("To Date should not be less than from date ");
            return false;
        } else {
            document.getElementById('TxtTodate').style.borderColor = "Gainsboro";
        }
        if (isValid) {
            data1 = { 'FromDate': FromDate, 'ToDate': ToDate, 'Type': Type };
            data = JSON.stringify(data1);
            $.ajax({
                type: 'POST',
                url: '/DomesticInventoryManagement/GetSummarydetails',
                data: data,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: true,
                success: function (response) {
                    debugger
                    SummaryList = [];
                    SummaryList = response;
                    $("#quotCount").html(response.length);
                    $('#tblContainerSummary').DataTable({
                        "destroy": true,
                        "bLengthChange": false,
                        "aaData": SummaryList,
                        "bPaginate": true,
                        "bInfo": false,
                        "paging": true,
                        order: [],
                        "searching": true,
                        "columns": [
                            //{
                            //    "data": "TransID",
                            //},
                            {
                                "data": "DisplayDate",
                            },
                            {
                                "data": "ContainerNo",
                            },
                            {
                                "data": "Size",
                            },
                            {
                                "data": "Type",
                            },
                            {
                                "data": "VendorName",
                            },
                            {
                                "data": "Remarks",
                            },
                            {
                                "data": "DisplayAddedOn",
                            },
                        ],
                        "aoColumnDefs": [
                            {
                                'bSortable': false,
                                'aTargets': [5],
                            }],
                        mark: true
                    });
                    var table = $('#tblContainerSummary').DataTable();

                    table = $('#tblContainerSummary').DataTable();
                    var buttons = new $.fn.dataTable.Buttons(table, {
                        buttons: [
                            {
                                extend: 'excelHtml5',
                                text: '<i class="fa fa-file-excel-o"></i>',
                                titleAttr: 'Excel',
                                className: 'btn btn_excel'
                            }
                        ]
                    }).container().appendTo($('#btnExcel'));
                },
                error: function (errormessage) {

                    alert(errormessage);
                    $("#tracker-loader").fadeOut("slow");
                }
            });
        }


    }

    function SaveNewContainerIN() {
        debugger
        $("global-loader").fadeIn();
        var ContainerM = {};
        var MasterID = "0";
        MasterID = $("#txtMasterID").val();
        if (MasterID == "0" || MasterID == "") {
            ContainerM.IsNew = 1;
            ContainerM.EntryID = 0;
        }
        else {
            ContainerM.IsNew = 0;
            ContainerM.EntryID = $("#txtMasterID").val();
        }
        ContainerM.INDate = $("#txtInDT").val();
        ContainerM.PurchaseDate = $("#txtPurchaseDT").val();
        ContainerM.ContainerNo = $("#txtContainerNo").val();
        ContainerM.Size = $("#ddlSize").val();
        ContainerM.Type = $("#ddlType").val();
        ContainerM.VendorName = $("#txtVendorName").val();
        ContainerM.Remarks = $("#txtRemarks").val();

        var isValidData = true;
        if (ContainerM.PurchaseDate == "") {
            $("#txtPurchaseDT").addClass("is-invalid");
            isValidData = isValidData && false;
        } else {
            $("#txtPurchaseDT").removeClass("is-invalid");
        }

        if (ContainerM.ContainerNo == "") {
            $("#txtContainerNo").addClass("is-invalid");
            isValidData = isValidData && false;
        } else {
            $("#txtContainerNo").removeClass("is-invalid");
        }
        if (ContainerM.Size == "") {
            $("#ddlSize").addClass("is-invalid");
            isValidData = isValidData && false;
        } else {
            $("#ddlSize").removeClass("is-invalid");
        }

        if (ContainerM.Type == "") {
            $("#ddlType").addClass("is-invalid");
            isValidData = isValidData && false;
        } else {
            $("#ddlType").removeClass("is-invalid");
        }

        if (ContainerM.VendorName == "") {
            $("#txtVendorName").addClass("is-invalid");
            isValidData = isValidData && false;
        } else {
            $("#txtVendorName").removeClass("is-invalid");
        }

        if (ContainerM.Remarks == "" || ContainerM.Remarks == null || ContainerM.Remarks == undefined) {
            ContainerM.Remarks = "";
        }
        if (isValidData == false) {
            alert("Please fill all required details");
            $("#global-loader").fadeOut("slow");
            return false;
        }

        var data = { 'ContainerINList': ContainerM };
        data = JSON.stringify(data);
        debugger

        $.ajax({
            type: "POST",
            url: "/DomesticInventoryManagement/SaveNewContainerIN",
            data: data,
            contentType: "application/json; charset=utf-8",
            success: function (response) {
                debugger
                alert(response.Message);
                reload();
                $("#global-loader").fadeOut("slow");
                //if (response.Status != 1) {
                //    alert(response.Message);
                //    $("#global-loader").fadeOut("slow");
                //}
                //else {
                //    $("#global-loader").fadeOut("slow");
                //    if (response.Status != 0) {
                //        alert(response.Message);
                //    } else {
                //        alert(response.Message);
                //    }
                //}
            },
            error: function (errormessage) {
                $("global-loader").fadeOut();
                $('#SaveButton').attr('disabled', false);
                alert(errormessage);
            }
        });
    }

</script>