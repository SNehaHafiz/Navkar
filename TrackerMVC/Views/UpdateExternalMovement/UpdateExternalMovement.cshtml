
@{
    ViewBag.Title = "External Movement";
    Layout = "~/Views/Shared/_LayoutDashboard.cshtml";
}
<script src="~/js/GetTableJson.js"></script>
<div id="divUpdateexternal">
    <div class="page-header">
        <h4 class="page-title">
            Update External Movement
        </h4>
        <div class="form-group">
            <label class="form-label"></label>
            <div class="row gutters-xs">
                <div class="col">
                    <a href='@Url.Action("DownloadUpTemplateOnly", "UpdateExternalMovement")' class="btn btn-warning"><i class="fa fa-download"></i></a>
                    <button type="button" class="btn btn-icon btn-teal" name="summarylist" title="Summary list" id="summarylist" onclick="addSummary();"><i class="fa fa-file-text"></i></button>
                    <a onclick="UploadVOucherTraiffDetails();" class="btn btn-primary  text-right" style="align-content:center;color:white"><i class="fa fa-upload" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Upload"></i>  </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12 col-lg-12">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-lg-3 col-sm-12">
                            <div class="form-group">
                                <label class="form-label mandatory">Movement Date </label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        <input ID="txtMovementDate" type="datetime-local" value="@ViewBag.Date" class="form-control" />
                                        <input ID="txtjono" type="text" style="display:none" class="form-control" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-3 col-sm-12">
                            <div class="form-group">
                                <label class="form-label">Vehicle No</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        <input ID="txtVehicleNo" type="text" placeholder="Vehicle No" class="form-control" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-2 col-sm-12">
                            <div class="form-group" style="padding-top:26px;">
                                <div class="row gutters-xs">
                                    <div class="col">
                                        @*<button type="button" class="btn btn-icon btn-teal" name="gstList" title="Summary list" id="gstList" onclick="gstList()"><i class="fa fa-file-text"></i></button>*@
                                        <button class="btn btn-primary" id="gstSearch" type="button" onclick="LoadContainerSearch()"><i class="fe fe-search"></i></button>
                                        @*<button class="btn btn-primary" id="btnView" style="display:none" type="button">View all</button>*@
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-3 col-sm-12">
                            <div class="form-group">
                                <label class="form-label">Container No.</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        <input ID="txtContainerNo" type="text" placeholder="Container No" class="form-control" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-2 col-sm-12">
                            <div class="form-group">
                                <label class="form-label">Jo No.</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        <input ID="txtjobno" type="text" placeholder="Job No" class="form-control" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-2 col-sm-12" style="margin-top:26px;">
                            <div class="form-group">

                                <div class="row gutters-xs">
                                    <div class="col">
                                        <button id="btnShow" class="btn btn-success btn-xs" onclick="ShowImportDetails()">Show</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-3 col-sm-12">
                            <div class="form-group">
                                <label class="form-label">Shipment No.</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        <input ID="txtShipmentNo" type="text" placeholder="Shipment No" class="form-control" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">

                        <div class="col-lg-4 col-sm-12">
                            <div class="form-group">
                                <label class="form-label">From</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        @Html.DropDownList("ddlFrom", (IEnumerable<SelectListItem>)ViewBag.FromList, "--Select--", new { @class = "form-control", @id = "ddlFrom", name = "ddlFrom", autocomplete = "off" })
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="row">

                        <div class="col-lg-4 col-sm-12">
                            <div class="form-group">
                                <label class="form-label">To</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        @Html.DropDownList("ddlTo", (IEnumerable<SelectListItem>)ViewBag.FromList, "--Select--", new { @class = "form-control", @id = "ddlTo", name = "ddlTo", autocomplete = "off" })
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-2 col-sm-12">
                            <div class="form-group">
                                <label class="form-label">Size</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        @Html.DropDownList("ddlSize", (IEnumerable<SelectListItem>)ViewBag.SizeList, "--Select--", new { @class = "form-control", @id = "ddlSize", name = "ddlSize", autocomplete = "off" })
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-2 col-sm-12">
                            <div class="form-group">
                                <label class="form-label">Type</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        @Html.DropDownList("ddlType", (IEnumerable<SelectListItem>)ViewBag.TypeList, "--Select--", new { @class = "form-control", @id = "ddlType", name = "ddlType", autocomplete = "off" })
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>



                    <div class="row">
                        <div class="col-lg-6 col-sm-12">
                            <div class="form-group">
                                <label class="form-label">Remarks</label>
                                <div class="row gutters-xs">
                                    <div class="col">
                                        <input ID="txtRemarks" type="text" placeholder="Remarks" class="form-control" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-2 col-sm-12">
                            <div class="form-group">

                                <div class="row gutters-xs">
                                    <div class="col">
                                        <button id="btnSave" class="btn btn-success btn-xs" onclick="return Addsave();">Save</button>
                                        @*<input type="button" name="clear" value="Clear" class="btn btn-default" title="clear" id="clearValue" />*@
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>



                </div>
            </div>

        </div>

    </div>
    <script>
    function Addsave() {

        var txtContainerNo = document.getElementById('txtContainerNo').value;
        var txtMovementDate = document.getElementById('txtMovementDate').value;
        var txtVehicleNo = document.getElementById('txtVehicleNo').value;
        var ddlFrom = document.getElementById('ddlFrom').value;
        var ddlTo = document.getElementById('ddlTo').value;
        var ddlSize = document.getElementById('ddlSize').value;
        var ddlType = document.getElementById('ddlType').value;
        var txtRemarks = document.getElementById('txtRemarks').value;
        var txtjono = document.getElementById('txtjono').value;
        var txtjono = document.getElementById('txtShipmentNo').value;

            //alert("hii")

        if (txtVehicleNo == "") {
            document.getElementById("txtVehicleNo").style.borderColor = "red";
            alert('Please enter Vehicle No!')
            event.preventDefault();
            return;
        }

        if (txtRemarks == "") {
            document.getElementById("txtRemarks").style.borderColor = "red";
                alert('Please enter Remarks!')
                event.preventDefault();
                return;
            }


        var UpdateExternalMovement = {};
        UpdateExternalMovement.ContainerNo = txtContainerNo;
        UpdateExternalMovement.MovementDate = txtMovementDate;
        UpdateExternalMovement.Vehicle = txtVehicleNo;
        UpdateExternalMovement.fromid = ddlFrom;
        UpdateExternalMovement.toid = ddlTo;
        UpdateExternalMovement.Size = ddlSize;
        UpdateExternalMovement.Type = ddlType;
        UpdateExternalMovement.Reamrks = txtRemarks;
        UpdateExternalMovement.jono = txtjono;
        UpdateExternalMovement.ShipmentNo = txtShipmentNo;

    $.ajax({
        url: "/UpdateExternalMovement/Save",
        data: '{SaveUpdateMovementEntities: ' + JSON.stringify(UpdateExternalMovement) + '}',
    type: "POST",
    contentType: "application/json; charset=utf-8",
    dataType: "json",
    success: function (result) {
        if(JSON.stringify(result)==0)

        {
            alert('Record Update successfully');
            window.location.href = '@Url.Action("UpdateExternalMovement", "UpdateExternalMovement")';
        }


    },
    error: function (errormessage) {
    alert(errormessage.responseText);
    }
    });
        }


    </script>
    <script type="text/javascript">
        function ShowImportDetails() {
            var txtContainerNo = document.getElementById('txtContainerNo').value;
            var txtjobno = document.getElementById('txtjobno').value;

            if (txtContainerNo == "") {
                document.getElementById("txtContainerNo").style.borderColor = "red";
                alert('Please enter Container No !')
                event.preventDefault();
                return;
            }

            if (txtjobno == "") {
                document.getElementById("txtjobno").style.borderColor = "red";
                alert('Please enter Container No !')
                event.preventDefault();
                return;
            }
             
            var ContainerNo = $("#txtContainerNo").val()
            var Jono = $("#txtjobno").val()
            var data = { 'ContainerNo': $("#txtContainerNo").val(), 'Jono': $("#txtjobno").val() };
            var data1 = JSON.stringify(data);
            $.ajax({
                url: "/UpdateExternalMovement/ajaxSearchlistdetails",
                data: data1,
                type: "POST",
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $("#ddlFrom").val(data.ImportList.fromid);
                    $("#ddlTo").val(data.ImportList.toid);
                    $("#ddlSize").val(data.ImportList.Size);
                    $("#ddlType").val(data.ImportList.Type);
                    $("#txtShipmentNo").val(data.ImportList.ShipmentNo);
                },
                error: function (errormessage) {
                    alert(errormessage.responseText);
                }
            });
        }
    </script>
    </div>
<div id="divupdatesummary" style="display:none">
    <div class=" content-area">
        <div class="page-header">
            <h4 class="page-title">Update External Movement Report</h4>

            <div class="form-group">
                <label class="form-label"></label>
                <div class="row gutters-xs">
                    <div class="col">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a onclick="goBack();" class="btn btn-primary btn-success" style="color:white;align-content:center;"><i class="fa fa-arrow-left" data-placement="bottom" title="Back"></i>  </a></li>
                        </ol>
                    </div>
                </div>

            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="form-horizontal">
                            <div class="row">
                                <div class="col-lg-3 col-sm-12">
                                    <div class="form-group">
                                        <label class="form-label"> From Date</label>
                                        <div class="row gutters-xs">
                                            <div class="col">
                                                @Html.TextBox("txtFromDate", null, new { @class = "form-control form_datetime1", @Value = DateTime.Now.ToString("dd MMM yyyy 00:00") })
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-sm-12">
                                    <div class="form-group">
                                        <label class="form-label"> To Date</label>
                                        <div class="row gutters-xs">
                                            <div class="col">
                                                @Html.TextBox("txtToDate", null, new { @class = "form-control form_datetime1", @Value = DateTime.Now.ToString("dd MMM yyyy 23:59") })
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-3 col-sm-12">
                                    <div class="form-group">
                                        <label class="form-label">Search By</label>
                                        <div class="row gutters-xs">
                                            <div class="col">
                                                @Html.DropDownList("ddlSearchby", new List<SelectListItem>
                                                  { new SelectListItem { Text = "All", Value = "All"},
                                                      new SelectListItem { Text = "Vessel", Value = "Vessel"},
                                                    new SelectListItem { Text = "Line Name", Value = "Line Name"},
                                                    new SelectListItem { Text = "Port", Value = "Port"},
                                                      new SelectListItem { Text = "Transporter", Value = "Transporter"},
                                                    new SelectListItem { Text = "Container No", Value = "Container No"},
                                                    }, new { @class = "form-control", autocomplete = "off", @id = "ddlSearchby" })
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-3 col-sm-12" style="display:none" id="divVessel">
                                    <div class="form-group">
                                        <label class="form-label mandatory">Vessel</label>
                                        <div class="row gutters-xs">
                                            <div class="col">
                                                @Html.DropDownList("ddlVessel", (IEnumerable<SelectListItem>)ViewBag.VesselList, "--Select--", new { @class = "form-control", @id = "ddlVessel", name = "ddlVessel", autocomplete = "off" })
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-3 col-sm-12" style="display:none" id="divLineName">
                                    <div class="form-group">
                                        <label class="form-label mandatory">Line Name</label>
                                        <div class="row gutters-xs">
                                            <div class="col">
                                                @Html.DropDownList("ddlLinename", (IEnumerable<SelectListItem>)ViewBag.SlList, "--Select--", new { @class = "form-control", @id = "ddlLinename", name = "ddlLinename", autocomplete = "off" })
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-3 col-sm-12" style="display:none" id="divPort">
                                    <div class="form-group">
                                        <label class="form-label mandatory">Port</label>
                                        <div class="row gutters-xs">
                                            <div class="col">
                                                @Html.DropDownList("ddlPort", (IEnumerable<SelectListItem>)ViewBag.PortsList, "--Select--", new { @class = "form-control", @id = "ddlPort", name = "ddlPort", autocomplete = "off" })
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-3 col-sm-12" style="display:none" id="divTransporter">
                                    <div class="form-group">
                                        <label class="form-label mandatory">Transporter</label>
                                        <div class="row gutters-xs">
                                            <div class="col">
                                                @Html.DropDownList("ddlTransporter", (IEnumerable<SelectListItem>)ViewBag.TransList, "--Select--", new { @class = "form-control", @id = "ddlTransporter", name = "ddlTransporter", autocomplete = "off" })
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-3 col-sm-12" style="display:none" id="divcontainer">
                                    <div class="form-group">
                                        <label class="form-label mandatory">Container No</label>
                                        <div class="row gutters-xs">
                                            <div class="col">
                                                @*@Html.EditorFor(model => model.CHACode, new { htmlAttributes = new { @class = "form-control", @id = "chaCode", autocomplete = "off", maxlength = 20 } })*@
                                                <input id="txtcontainerNo" placeholder="Enter Container No" type="text" class="form-control" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-1 col-sm-12">
                                    <div class="form-group">
                                        <label class="form-label" style="visibility:hidden"> '</label>
                                        <div class="row gutters-xs">
                                            <div class="col">
                                                <input type="button" value="Show" class="btn btn-primary" id="btnSubmit" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @Html.ActionLink("Export To Excel", "ExportToExcelExternalMovemnet", null, new { @class = "btn btn-primary btn-md" })
                            <div class="row">
                                <div class="col-lg-12 col-sm-12">
                                    <div class="table-responsive">
                                        <table id="example2" class="table table-bordered table-hover tbl-cart text-nowrap" style="width:100%">
                                            <thead>

                                                <tr>
                                                    @*<th class="wd-10p sorting">Sr No</th>
                                                        <th class="wd-10p sorting">Paid ID</th>*@
                                                </tr>
                                            </thead>

                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>    
</div>
<div class=" content-area" id="divUploadExtMovement" style="display:none">
    <div class="page-header">
        <h4 class="page-title">Upload External Movement Update Container</h4>
        <div class="ibox-content  text-right">
            <a onclick="getBackNew();" class="btn btn-primary btn-success" style="color:white;align-content:center;"><i class="fa fa-arrow-left" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Back"></i>  </a></li>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="form-horizontal">
                        <div class="row">
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">Criteria</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            <select id="ddlCriteria" class="form-control">
                                                <option value="">--Select--</option>
                                                <option value="Import">Import</option>
                                                <option value="Export">Export</option>
                                                <option value="Depot Movement">Depot Movement</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label">Jo No</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("txtShipmentJoNo", null, new { @class = "form-control", @autocomplete="false", @placeholder="Shipment/Jo No" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-12">
                                <div class="form-group" style="padding-top:30px">
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            <input type="file" id="fileImport" name="postedFile" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-2 col-sm-12">
                                <div class="form-group" style="padding-top:25px">
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            <button class="btn btn-primary" id="btnImport" type="button">Import</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12 col-sm-12">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover tbl-cart text-nowrap" id="tblUpdateExcel" style="width:100%;">
                                        <thead>
                                            <tr>
                                                <th class="wd-10p sorting">##</th>
                                                <th class="wd-10p sorting ">Container No</th>
                                                <th class="wd-10p sorting">Size </th>
                                                <th class="wd-10p sorting">Type</th>
                                                <th class="wd-10p sorting">Location From</th>
                                                <th class="wd-10p sorting">Location To</th>
                                                <th class="wd-10p sorting">Movement Date</th>
                                                <th class="wd-10p sorting">Vehicle No</th>
                                                <th class="wd-10p sorting">Jo No</th>
                                            </tr>
                                        </thead>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-1 col-xs-12">
                                <div class="form-group" style="padding-top:25px">
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            <button class="btn btn-success pull-right" type="button" id="btnSave" onclick="SaveMov();" name="Save">Save</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-1 col-xs-12">
                                <div class="form-group" style="padding-top:25px">
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            <button class="btn btn-default pull-right" type="button" id="btnClear" onclick="Clear();" name="Clear">Clear</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal  fade" id="TestModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" id='myModalContent'>
        </div>
    </div>
</div>
    <script type="text/javascript">
        $("#ddlSearchby").change(function () {

            var ddlSearchby = $("#ddlSearchby option:selected").text();

            if (ddlSearchby == "Vessel") {
                $("#divVessel").show();
                $("#divLineName").hide();
                $("#divPort").hide();
                $("#divTransporter").hide();
                $("#divcontainer").hide();
            }

            if (ddlSearchby == "Line Name") {
                $("#divVessel").hide();
                $("#divLineName").show();
                $("#divPort").hide();
                $("#divTransporter").hide();
                $("#divcontainer").hide();
            }

            if (ddlSearchby == "Port") {
                $("#divLineName").hide();
                $("#divVessel").hide();
                $("#divPort").show();
                $("#divTransporter").hide();
                $("#divcontainer").hide();
            }

            if (ddlSearchby == "Transporter") {
                $("#divLineName").hide();
                $("#divVessel").hide();
                $("#divPort").hide();
                $("#divTransporter").show();
                $("#divcontainer").hide();
            }

            if (ddlSearchby == "Container No") {
                $("#divLineName").hide();
                $("#divVessel").hide();
                $("#divPort").hide();
                $("#divTransporter").hide();
                $("#divcontainer").show();
            }


            if (ddlSearchby == "All") {
                $("#divLineName").hide();
                $("#divVessel").hide();
                $("#divPort").hide();
                $("#divTransporter").hide();
                $("#divcontainer").hide();
            }


        });
    </script>
  
        <script>
            $("#btnSubmit").click(function () {
                import_View();
            })
            function import_View() {

                $("#tracker-loader").fadeIn("slow");
                var FromDate = $("#txtFromDate").val()
                var ToDate = $("#txtToDate").val()
                var SearchCriteria = $("#ddlSearchby option:selected").text()
                var SearchText = "";

                if (Date.parse(FromDate) > Date.parse(ToDate)) {
                    alert("Invalid Date Range");
                }
                else {
                    // alert("Valid date Range");


                    if ($("#ddlSearchby").val() == "Vessel") {

                        var SearchText = $("#ddlVessel option:selected").text()
                        // alert(SearchText)
                    }
                    else if ($("#ddlSearchby").val() == "Line Name") {
                        // alert("hi")
                        var SearchText = $("#ddlLinename option:selected").text()


                    }
                    else if ($("#ddlSearchby").val() == "Port") {
                        // alert("hi")
                        var SearchText = $("#ddlPort option:selected").text()


                    }
                    else if ($("#ddlSearchby").val() == "Transporter") {
                        // alert("hi")
                        var SearchText = $("#ddlTransporter option:selected").text()


                    }

                    else if ($("#ddlSearchby").val() == "Container No") {
                        // alert("hi")
                        var SearchText = $("#txtcontainerNo").val()
                    }
                   
                        //var data = { 'fromDate': $("#txtFromDate").val(), 'ToDate': $("#txtToDate").val() };
                        //data = JSON.stringify(data);
                    $.ajax({
                        type: 'POST',
                        url: '/UpdateExternalMovement/GetDataBind',
                        data: '{FromDate: ' + JSON.stringify(FromDate) + ', ToDate: ' + JSON.stringify(ToDate) + ',SearchCriteria: ' + JSON.stringify(SearchCriteria) + ',SearchText: ' + JSON.stringify(SearchText) + '}',
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        async: true,
                        success: function (data) {

                            $("#example2").empty();
                            RepTableDataJson($("#example2"), data, "UpdateExternalMovement", "UpdateExternalMovement");
                            $("#tracker-loader").fadeOut("slow");
                        },
                        error: function (errormessage) {
                            alert(errormessage.responseText);
                            $("#tracker-loader").fadeOut("slow");
                        }
                    });
                    //$("#divLoader").hide();
                }
            }
            function LoadContainerSearch() {

                $.ajax({
                    type: "POST",
                    url: "/UpdateExternalMovement/ContainerListSearch",
                    //data: data,
                    contentType: "application/json; charset=utf-8",
                    success: function (response) {

                        //alert(response);
                        $('#TestModal').modal('show');
                        $('#myModalContent').html(response);
                    },
                    failure: function (response) {
                        alert(response);
                        alert(response.responseText);
                    },
                    error: function (response) {
                        alert(response.responseText);
                    }

                })
            }


        </script>

    <Script type="text/javascript">
        function addSummary() {
            $("#divUpdateexternal").hide();
            $('#divupdatesummary').show();
            $('#example2').show();
        }
        function goBack() {
            $("#divUpdateexternal").show();
            $('#divupdatesummary').hide();
            $('#example2').hide();
        }

        function UploadVOucherTraiffDetails() {
            $("#divUpdateexternal").hide();
            $("#divupdatesummary").hide();
            $("#divUploadExtMovement").show();
        }

        function getBackNew() {
            $("#divUpdateexternal").show();
            $("#divupdatesummary").hide();
            $("#divUploadExtMovement").hide();
        }

        $('#btnImport').click(function () {
            debugger;
            //$('#btnImport').attr('disabled', 'disabled');
            //alert("Hello");

            if (ValidationExt() == false) {
                return;
            }

            if (window.FormData !== undefined) {

                var fileUpload = $("#fileImport").get(0);
                var files = fileUpload.files;

                // Create FormData object
                var fileData = new FormData();
                if (files.length == 0) {
                    alert("Please select File!")
                    return false;
                }
                else {
                    //   alert(document.getElementById('fileJOAttachment').files[0].size / 1024)
                    var iSize = document.getElementById('fileImport').files[0].size / 1024
                    $('#hdnFileCount').val(files.length);

                    iSize = (Math.round((iSize / 1024) * 100) / 100)
                    //alert(iSize)
                    //var ddlFileType = document.getElementById('ddlFileType').value;
                    //var txtViaNo = document.getElementById('txtViaNo').value;
                    //var txtJONo = document.getElementById('JONo').value;
                    if (iSize > 5) {
                        alert("Selected file size more than 5 MB");
                        return false;
                    }
                    // Looping over all files and add it to FormData object
                    for (var i = 0; i < files.length; i++) {

                        fileData.append(files[i].name, files[i]);
                    }

                    if ($("#ddlCriteria").val() == '') {
                        alert("Please select Criteria");
                        return false;
                    }

                    
                    if ($("#ddlCriteria").val() == "Depot Movement") {
                        if ($("#txtShipmentJoNo").val() == "") {
                            alert("Please enter Jo Number.");
                            return;
                        }
                    }


                    $('#btnImport').attr('disabled', 'disabled');

                    // Adding one more key to FormData object
                    fileData.append('File_status_Name', $("#ddlCriteria").val());
                    fileData.append('HBLNumber', $("#txtShipmentJoNo").val());
                    debugger;
                    // alert("hi")
                    $.ajax({
                        url: '/UpdateExternalMovement/UpdateExtMovement',
                        type: "POST",
                        contentType: false, // Not to set any content header
                        processData: false, // Not to process data
                        data: fileData,
                        success: function (Data) {
                            debugger;
                            //$('#btnImport').removeAttr('disabled');
                            try {
                                if (Data.message != "") {
                                    alert(Data.message);
                                    $('#btnImport').removeAttr('disabled', 'disabled');
                                    return;
                                }

                                if (Data != "") {
                                    $('#tblUpdateExcel').dataTable({
                                        "destroy": true,
                                        "paging": false,
                                        "bLengthChange": false,
                                        "aaData": Data.ContainerList,
                                        "aaSorting": [[0, 'desc']],
                                        "columns": [
                                            {
                                                "data": "SrNo",
                                                "render": function (data, type, row, meta) {
                                                    if (type === 'display') {

                                                        data = "<button type=\"button\" class=\"btn btn-icon btn-primary btn-danger removebutton \" name=\"removebutton\" style=\"height:35px;\" onclick=\"CancelItem(this)\"><i class=\"fe fe-trash\" style=\"font-size: 16px;\"></i></button>";
                                                    }

                                                    return data;
                                                }
                                            },
                                            { "data": "ContainerNo" },
                                            { "data": "Size" },
                                            { "data": "Type" },
                                            { "data": "From" },
                                            { "data": "To" },
                                            { "data": "DischargeDate" },
                                            { "data": "VehicleNo" },
                                            { "data": "JoNumber" },
                                        ]
                                    })
                                    $('#btnImport').removeAttr('disabled', 'disabled');
                                }
                                else {
                                    //$("#divIgmErrorShow").css('visibility', 'visible');
                                    // alert('Getting Error while upload . Please click on Error Genarate Button for details !');
                                }
                            }
                            catch (ex) {
                                //$('#btnImport').removeAttr('disabled');
                                alert(ex.validationMessage);
                            }
                        }
                    });
                    //$('#btnImport').removeAttr('disabled');

                }
            }
        });

        function ValidationExt() {
            var result = true;

            if ($("#ddlCriteria").val() == "Depot Movement") {
                if ($("#txtShipmentJoNo").val() == "") {
                    alert("Please enter Shipment/Jo Number.");
                    return;
                }
            }

            if ($("#ddlCriteria").val() == "") {
                alert("Please select Criteria.");
                return;
            }
            if ($("#ddlCriteria").val() == "Depot Movement") {
                $.ajax({
                    type: 'POST',
                    url: '/UpdateExternalMovement/getValidation',
                    data: '{ShipmentJoNo: ' + JSON.stringify($("#txtShipmentJoNo").val()) + ', Criteria: ' + JSON.stringify($("#ddlCriteria").val()) + '}',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    async: false,
                    success: function (data) {
                        debugger;
                        if (data != "Success") {
                            alert(data);
                            $("#txtShipmentJoNo").val("");
                            result = false;
                        }
                        else {
                            result = true;
                        }
                        $("#tracker-loader").fadeOut("slow");
                    },
                    error: function (errormessage) {
                        alert(errormessage.responseText);
                        $("#tracker-loader").fadeOut("slow");
                    }
                });
            }
            else {
                result = true;
            }
            
            return result;
        }

        function SaveMov() {
            debugger;
            var SelectedData = new Array();

            $('#tblUpdateExcel tbody tr').each(function (i, row) {
               
                var data = {};

                $(this).find('input').each(function () {

                    data[this.id] = $(this).val();
                })
                SelectedData.push(data);

            });

            var data1 = { 'MovData': SelectedData, 'Criteria': $("#ddlCriteria").val(), 'ShipmentNo': $("#txtShipmentJoNo").val() };

            var data = JSON.stringify(data1);

            $.ajax({
                url: "/UpdateExternalMovement/SaveExtExcel",
                data: data,
                type: "POST",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {

                    if (response >= "1") {
                        alert("Record saved successfully");
                        window.location = "/UpdateExternalMovement/UpdateExternalMovement";
                        //Clear();
                    }
                    else {
                        alert("Record not saved successfully. Try Again!");
                        $("#btnsave").removeAttr('disabled');
                    }
                },
                error: function (errormessage) {
                    alert("error");
                    alert(errormessage.responseText);
                }
            })

        }

    </Script>

