
@{
    ViewBag.Title = "Fastag Master";
    Layout = "~/Views/Shared/_LayoutDashboard.cshtml";
}

<div id="tracker-loader"></div>
<div class="content-area overflow-hidden" id="divfastag">
    <div>
        <div class="page-header">
            <h4 class="page-title">Fastag Master</h4>
            <div class="form-group">
                <label class="form-label"></label>
                <div class="row gutters-xs">
                    <div class="col">

                        <button type="button" class="btn btn-icon btn-teal" name="summarylist" title="Summary list" id="summarylist" onclick="ViewSummary();"><i class="fa fa-file-text"></i></button>


                    </div>
                </div>
            </div>
        </div>
     
        <div class="row">
            <div class="col-md-12 col-lg-12">
                <div class="card">
                    <div class="card-body p-6">
                        <div class="row">
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">Trailer No(Last 4 digits)</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("txtTrailerno", null, new { @class = "form-control", @id = "Trailerno", name = "Trailerno", autocomplete = "off", placeholder = "Trailer No", @maxlength = 4 })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-sm-12" id="divtrailernodrop">
                                <label class="form-label">Trailer No </label>
                                <select id="ddlTrailerNo" class="form-control">
                                    <option value="">--Select--</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">Tag No.</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("TxtTagNo", null, new { @class = "form-control", @id = "TxtTagNo", @name = "TxtTagNo", autocomplete = "off" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">Remarks</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("TxtRemakrs", null, new { @class = "form-control", @id = "TxtRemakrs", @name = "TxtRemakrs", autocomplete = "off" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-3 col-xs-12">
                                <div class="form-group">
                                    <label class="custom-switch">
                                        <input type="checkbox" name="custom-switch-checkbox" id="chkIsActive" value="true" checked class="custom-switch-input">
                                        <span class="custom-switch-indicator"></span>
                                        <span class="custom-switch-description">Is Active?</span>
                                    </label>
                                </div>
                            </div>
                        </div>


                        <div class="row">
                            <div class="col-md-1 col-xs-4">
                                <div class="form-group">
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            <button class="btn btn-success btn-xs" id="btnSaveDriver" onclick="SaveDetails();">Save</button>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<div class=" content-area" id="divView" style="display:none">
    <div class="page-header">
        <h4 class="page-title">Fastag Details</h4>
        <div class="ibox-content  text-right">
            <a onclick="getBack();" class="btn btn-primary btn-success" style="color:white;align-content:center;"><i class="fa fa-arrow-left" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Back"></i>  </a></li>
        </div>

    </div>
    <div class="row">
        <div class="col-md-12 col-lg-12">
            <div class="card">
                <div class="card-body">

                    <div class="row">
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover tbl-cart text-nowrap" id="example">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th class="wd-15p sorting">Entry ID</th>
                                        <th class="wd-15p sorting">Entry Date</th>
                                        <th class="wd-15p sorting">Vehicle No.</th>
                                        <th class="wd-15p sorting">tag ID</th>
                                        <th class="wd-15p sorting">Status</th>
                                        <th class="wd-15p sorting">Remarks</th>
                                        <th class="wd-15p sorting">Generated By</th>
                                    </tr>
                                    
                                </thead>

                            </table>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>


<div class="content-area overflow-hidden" id="divEditfastag" style="display:none">
    <div>
        <div class="page-header">
            <h4 class="page-title">Edit Fastag Master</h4>
            <div class="ibox-content  text-right">
                <a onclick="getBack1();" class="btn btn-primary btn-success" style="color:white;align-content:center;"><i class="fa fa-arrow-left" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Back"></i>  </a></li>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12 col-lg-12">
                <div class="card">
                    <div class="card-body p-6">
                        <div class="row">
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">Trailer No</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("txtEditTrailerno", null, new { @class = "form-control", @id = "txtEditTrailerno", name = "txtEditTrailerno", autocomplete = "off", placeholder = "Trailer No", @maxlength = 4 ,@readonly=true})
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-3 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">Tag No.</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("TxtEditTagNo", null, new { @class = "form-control", @id = "TxtEditTagNo", @name = "TxtEditTagNo", autocomplete = "off", @readonly = true })
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-sm-12">
                                <div class="form-group">
                                    <label class="form-label mandatory">Remarks</label>
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            @Html.TextBox("TxtEditRemakrs", null, new { @class = "form-control", @id = "TxtEditRemakrs", @name = "TxtEditRemakrs", autocomplete = "off"})
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-3 col-xs-12">
                                <div class="form-group">
                                    <label class="custom-switch">
                                        <input type="checkbox" name="custom-switch-checkbox" id="chkEditIsActive" value="true" checked class="custom-switch-input">
                                        <span class="custom-switch-indicator"></span>
                                        <span class="custom-switch-description">Is Active?</span>
                                    </label>
                                </div>
                            </div>
                        </div>


                        <div class="row">
                            <div class="col-md-1 col-xs-4">
                                <div class="form-group">
                                    <div class="row gutters-xs">
                                        <div class="col">
                                            <button class="btn btn-success btn-xs" id="btnSaveDriver" onclick="EditDetails();">Save</button>
                                            <input id="EditEntryid" style="visibility:hidden"/>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>



<script>
    $(window).on("load", function (e) {
        $("#tracker-loader").fadeOut("slow");
    })
</script>
<script>
    $('#Trailerno').change(function (e) {
        var trailerno = $("#Trailerno").val();
        $.ajax({
            url: "/ManualPortOut/AjaxGetTrailerNo",
            data: '{trailerno: ' + JSON.stringify(trailerno) + '}',
            type: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {

                var select = $("#ddlTrailerNo");

                select.empty();
                select.append($('<option/>', {
                    value: "",
                    text: "--Select--"
                }));

                $.each(data, function (data, value) {

                    select.append($("<option></option>").val(value.trailerid).html(value.trailername));
                })

                GetVehiclelastDetails(trailerno);



            },

            error: function (errormessage) {
                alert(errormessage.responseText);
            }
        });




    });




    function SaveDetails() {
        var res = validateFunction();
        if (res == false) {
            return false;
        }
        $("#tracker-loader").fadeIn("slow");
        var trailerid = $("#ddlTrailerNo option:selected").text();
        var tagno = $("#TxtTagNo").val();
        var remakrs = $("#TxtRemakrs").val();
        var chkIsActive = document.getElementById("chkIsActive").checked;

        var data1 = { 'trailerid': trailerid, 'tagno': tagno, 'remakrs': remakrs, 'chkIsActive': chkIsActive };
        var data = JSON.stringify(data1);
        $.ajax({
            url: "/Transporter/ChecktagNoExists",
            data: data,
            type: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                if (data == 1) {
                    alert("Record already exists in system!")
                    $("#tracker-loader").fadeOut("slow");

                } else {
                    Save();
                }
            },
            error: function (errormessage) {
                alert(errormessage.responseText);
            }
        });
    }


    function Save() {
        $("#tracker-loader").fadeIn("slow");
       var trailerid =  $("#ddlTrailerNo option:selected").text();
       var tagno =  $("#TxtTagNo").val();
      var remakrs =   $("#TxtRemakrs").val();
        var chkIsActive = document.getElementById("chkIsActive").checked;

        var data1 = { 'trailerid': trailerid, 'tagno': tagno, 'remakrs': remakrs, 'chkIsActive': chkIsActive };
        var data = JSON.stringify(data1);
        $.ajax({
            url: "/Transporter/SaveFastagDetails",
            data: data,
            type: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                alert("record saved successfully")
                document.location='@Url.Action("FasterMaster", "Transporter")'
                $("#tracker-loader").fadeOut("slow");
            },

            error: function (errormessage) {
                alert(errormessage.responseText);
                $("#tracker-loader").fadeOut("slow");
            }
        });

    }


    function ViewSummary() {
        $("#divView").show();
        $("#divfastag").hide();
        $("#divEditfastag").hide();
        $("#tracker-loader").fadeIn("slow");
       
        $.ajax({

            url: '/Transporter/GetFasttagDetails',
            type: 'Post',
            async: false,
            contentType: 'application/json; charset=utf-8',
            success: function (data) {

                $('#example').dataTable({
                    "destroy": true,
                    "bLengthChange": false,
                    "aaData": data,
                    "bInfo": false,
                    "bPaginate": false,
                    "bFilter": true,
                    "paging": false,
                    "dom": 'Bfrtip',
                    "buttons": [{
                        "extend": 'excel',
                        "title": 'Fastag Master',
                        "filename": 'Fastag Master'

                    }
                    ],
                    "columns": [
                        {
                            "data": "entryid",
                            "render": function (data, type, row, meta) {
                                if (type === 'display') {

                                    data = '<a   href="#" class="btn btn-sm btn-info" title="Edit" onclick="EditFasttagdetails(' + row.entryid + ',\'' + row.VehicleNo.replace(/'/g, "\\'") + '\',\'' + row.tagID.replace(/'/g, "\\'") + '\',\'' + row.Remarks.replace(/'/g, "\\'") + '\',' + row.isactive + ')"><i class="fa fa-edit"></i></a>';
                                }

                                return data;
                            }


                        },
                        { "data": "entryid" },
                        { "data": "Entrydate" },
                        { "data": "VehicleNo" },
                        { "data": "tagID" },
                        { "data": "Status" },
                        { "data": "Remarks" },
                        { "data": "UserName" },
                    ]
                });
                $("#tracker-loader").fadeOut("slow");
            },
            error: function (errormessage) {
                alert(errormessage.responseText);
                $("#tracker-loader").fadeOut("slow");
            }


        });
    }
    
  
</script>

<script>
    function EditFasttagdetails(entryid, VehicleNo, tagID, Remarks, isactive) {
      
        $("#divfastag").hide();
        $("#divView").hide();
        $("#divEditfastag").show();
       
           $("#EditEntryid").val(entryid);
           $("#txtEditTrailerno").val(VehicleNo);
           $("#TxtEditTagNo").val(tagID);
           $("#TxtEditRemakrs").val(Remarks);
           if (isactive == 0) {
               document.getElementById("chkEditIsActive").checked = false;
           } else {
               document.getElementById("chkEditIsActive").checked = true;
           }
    } 

    function getBack() {
        $("#divfastag").show();
        $("#divView").hide();
        $("#divEditfastag").hide();
    }
    function getBack1() {
        $("#divfastag").hide();
        $("#divView").show();
        $("#divEditfastag").hide();
    }


    function EditDetails() {

        var EditEntryid = $("#EditEntryid").val();
        var EditTagNo = $("#TxtEditTagNo").val();
        var EditchkIsActive = document.getElementById("chkEditIsActive").checked;
        var data1 = { 'EditEntryid': EditEntryid, 'EditTagNo': EditTagNo, 'chkIsActive': EditchkIsActive };
        var data = JSON.stringify(data1);
        $.ajax({
            url: "/Transporter/EditFastagDetails",
            data: data,
            type: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                alert("record saved successfully")
                document.location='@Url.Action("FasterMaster", "Transporter")'
                $("#tracker-loader").fadeOut("slow");
            },

            error: function (errormessage) {
                alert(errormessage.responseText);
                $("#tracker-loader").fadeOut("slow");
            }
        });

    }

</script>


<script>
    function validateFunction() {

        var Txtfromlocation = document.getElementById('ddlTrailerNo').value;
        var txtTolocation = document.getElementById('TxtTagNo').value;
        var TxtToll = document.getElementById('TxtRemakrs').value;
      





        document.getElementById("ddlTrailerNo").style.borderColor = "gainsboro";
        document.getElementById("TxtTagNo").style.borderColor = "gainsboro";
        document.getElementById("TxtRemakrs").style.borderColor = "gainsboro";
       


        var blResult = Boolean;
        blResult = true;


        if (Txtfromlocation == "") {
            //  document.getElementById('ContainerNo').style.borderColor = "red"
            document.getElementById("ddlTrailerNo").style.borderColor = "red";
            blResult = blResult && false;
        }
        if (txtTolocation == "") {
            //  document.getElementById('ContainerNo').style.borderColor = "red"
            document.getElementById("TxtTagNo").style.borderColor = "red";
            blResult = blResult && false;
        }
        if (TxtToll == "") {
            //  document.getElementById('ContainerNo').style.borderColor = "red"
            document.getElementById("TxtRemakrs").style.borderColor = "red";
            blResult = blResult && false;
        }

        if (blResult == false) { alert('Please fill the required fields!'); }
        return blResult;

    };
</script>
