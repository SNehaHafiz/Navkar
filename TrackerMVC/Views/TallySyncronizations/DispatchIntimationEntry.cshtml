
@{
    ViewBag.Title = "Dispatch Intimation Entry";
    Layout = "~/Views/Shared/_LayoutDashboard.cshtml";
}



<script src="~/js/GetTableJson.js"></script>
<script src="~/js/GetTableArray.js"></script>

<div id="tracker-loader"></div>
<div class=" content-area overflow-hidden">

    <div class="page-header">
        <h4 class="page-title">Dispatch Intimation Entry</h4>

    </div>
    <div class="row">
        <div class="col-md-12 col-lg-12">
            <div class="card">
                <div class="card-body">

                    <div class="row">
                        <div class="col-lg-12 col-sm-12">
                            <div class="form-group">
                                @*<label class="form-label">As On: </label>*@
                                <div class="row gutters-xs">
                                    <div class="col-md-12 col-lg-2">
                                        <label class="form-label">Based On</label>
                                        @Html.DropDownList("ddlBasedOn", new List<SelectListItem>
                                          { new SelectListItem { Text = "As On", Value = "1"},
                                            new SelectListItem { Text = "From To", Value = "2"}
                                           }, new { @class = "form-control", autocomplete = "off", onchange = "OnChangeBasedOn()" })
                                        @*@Html.TextBox("txtDate", null, new { @class = "form-control datePicker1", @id = "txtDate", autocomplete = "off", onchange = "CheckDate();", @value = @ViewBag.Date })*@
                                    </div>
                                    <div class="col-md-12 col-lg-2" id="divFromDate" style="padding-top:26px;display:none">
                                        @*<label class="form-label">From</label>*@
                                        @Html.TextBox("txtFromDate", null, new { @class = "form-control form_datetime1", @Value = DateTime.Now.ToString("dd MMM yyyy 08:00") })
                                        @*@Html.TextBox("txtDate", null, new { @class = "form-control datePicker1", @id = "txtDate", autocomplete = "off", onchange = "CheckDate();", @value = @ViewBag.Date })*@
                                    </div>
                                    <div class="col-md-12 col-lg-2" style="padding-top:26px;">
                                        @Html.TextBox("txtDate", null, new { @class = "form-control form_datetime1", @Value = DateTime.Now.AddDays(1).ToString("dd MMM yyyy 07:59") })
                                        @*@Html.TextBox("txtDate", null, new { @class = "form-control datePicker1", @id = "txtDate", autocomplete = "off", onchange = "CheckDate();", @value = @ViewBag.Date })*@
                                    </div>
                                    <div class="col-md-12 col-lg-6" style="padding-top:26px;">
                                        <button class="btn btn-primary " type="button" id="ALL" onclick="LoadData('ALL');">ALL</button>
                                        <button class="btn btn-primary" type="button" id="Import" onclick="LoadData('Import');">Import</button>
                                        <button class="btn btn-primary" type="button" id="Export" onclick="LoadData('Export');">Export</button>
                                        <button class="btn btn-primary" type="button" id="Bond" onclick="LoadData('Bond');">Bond</button>
                                        <button class="btn btn-primary" type="button" id="Other" onclick="LoadData('Other');">Other</button>
                                        <button class="btn btn-primary" type="button" id="Domestic" onclick="LoadData('Domestic');">Domestic</button>
                                        <button class="btn btn-primary" type="button" id="MNR" onclick="LoadData('MNR');">MNR</button>

                                    </div>


                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">


                        <div class="col-md-2 col-lg-2">
                            <div class="form-group label-floating">
                                <label class="form-label">No of Records</label>
                                @Html.TextBox("txtCount", null, new { @class = "form-control", @id = "txtCount", name = "txtCount", autocomplete = "off", style = "text-align:right", @readonly = "readonly" })
                            </div>
                        </div>
                    </div>
                        @*<div class="col-md-22 col-lg-2">
                            <div class="form-group label-floating">
                                <label class="form-label">SGST</label>
                                @Html.TextBox("txtSGST", null, new { @class = "form-control", @id = "txtSGST", name = "txtSGST", autocomplete = "off", style = "text-align:right", @readonly = "readonly" })
                            </div>
                        </div>
                        <div class="col-md-22 col-lg-2">
                            <div class="form-group label-floating">
                                <label class="form-label">CGST</label>
                                @Html.TextBox("txtCGST", null, new { @class = "form-control", @id = "txtCGST", name = "txtCGST", autocomplete = "off", style = "text-align:right", @readonly = "readonly" })
                            </div>
                        </div>
                        <div class="col-md-22 col-lg-2">
                            <div class="form-group label-floating">
                                <label class="form-label">IGST</label>
                                @Html.TextBox("txtIGST", null, new { @class = "form-control", @id = "txtIGST", name = "txtIGST", autocomplete = "off", style = "text-align:right", @readonly = "readonly" })
                            </div>
                        </div>
                        <div class="col-md-22 col-lg-2">
                            <div class="form-group label-floating">
                                <label class="form-label"> Total GST</label>
                                @Html.TextBox("txtTotalGST", null, new { @class = "form-control", @id = "txtTotalGST", name = "txtTotalGST", autocomplete = "off", style = "text-align:right", @readonly = "readonly" })
                            </div>
                        </div>
                        <div class="col-md-22 col-lg-2">
                            <div class="form-group label-floating">
                                <label class="form-label">Grand Total</label>
                                @Html.TextBox("txtTotal", null, new { @class = "form-control", @id = "txtTotal", name = "txtTotal", autocomplete = "off", style = "text-align:right", @readonly = "readonly" })
                            </div>
                        </div>*@
                    <div class="row">
                        <div class="col-md-22 col-lg-2">
                            <div class="form-group label-floating">
                                <label class="form-label">Docket No</label>
                                @Html.TextBox("txtDocketNo", null, new { @class = "form-control", @id = "txtDocketNo", name = "txtDocketNo", autocomplete = "off" })
                            </div>
                        </div>
                        <div class="col-md-22 col-lg-2">
                            <div class="form-group label-floating">
                                <label class="form-label">Docket Date</label>
                                @Html.TextBox("ToDate", null, new { @class = "form-control form_datetime1", @Value = DateTime.Now.ToString("dd MMM yyyy 07:59") })
                            </div>
                        </div>


                        <input type="hidden" name="txtCategory" id="txtCategory">


                    </div>



                    <div class="table-responsive">
                        @*<button class="btn btn-primary" name="btnExport" onclick="ExportToExcel()">Export to Excel</button>*@
                        <button class="btn btn-primary" name="btnLock" onclick="Lock()">Save</button>
                      
                        <table id="tblInvoiceList" class="table table-striped table-bordered" style="width:100%">
                            <thead>
                                <tr>
                                    @*<th class="wd-15p sorting" style="width:1px;"> <input type="checkbox" id="flowcheckall" value="" />&nbsp;Select    </th>*@
                                    <th class="wd-10p sorting"></th>
                                    <th class="wd-10p sorting"></th>
                                    <th class="wd-10p sorting">Select</th>
                                    <th class="wd-10p sorting">Category</th>
                                    <th class="wd-10p sorting">Invoice No</th>
                                    <th class="wd-10p sorting">Invoice Date</th>

                                    <th class="wd-10p sorting">Docket No.</th>
                                    <th class="wd-10p sorting">Docket Date</th>
                                    @*// <th class="wd-10p sorting">GST No</th>*@
                                    <th class="wd-10p sorting">GSTName</th>
                                    <th class="wd-10p sorting">Cha Name</th>
                                    @*// <th class="wd-10p sorting">State</th>*@
                                    @*<th class="wd-10p sorting">CGST</th>
        <th class="wd-10p sorting">IGST</th>*@
                                    <th class="wd-10p sorting">Total GST</th>
                                    <th class="wd-10p sorting">Grand Total</th>
                                    @*<th class="wd-10p sorting">work year</th>*@

                                </tr>
                            </thead>

                        </table>


                    </div>

                </div>
                <!-- section-wrapper -->
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="row">
                <div class="col-md-12 col-lg-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">


                                <div class="col-md-4 col-lg-6">
                                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                                        <thead>
                                            <tr>
                                                <th class="wd-10p sorting">Container No.</th>


                                            </tr>
                                        </thead>

                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


                <script>

                    function OnChangeBasedOn() {
                        //alert(document.getElementById('ddlBasedOn').value);
                        if (document.getElementById('ddlBasedOn').value == "1") {
                            $("#divFromDate").hide();
                        }
                        else {
                            $("#divFromDate").show();
                        }
                    }

    function Lock() {
       

       var category = $('#txtCategory').val();

        var checkboxarray = [];
        $('input[type=checkbox]').each(function () {
            if (this.checked) {

                checkboxarray.push($(this).val());
            }
        });


        var tablearray = [];
        var table = document.getElementById("tblInvoiceList");
        var row;
        for (var i = 1; i < table.rows.length; i++) {

            row = table.rows[i];

            for (var k = 0; k < checkboxarray.length; k++) {


                var InvoiceNo = row.cells[2].childNodes[0].value;

                if (InvoiceNo == checkboxarray[k]) {
                    DocketNo = $('#txtDocketNo').val();
                    DocketDate = $('#ToDate').val();
                    if (DocketNo == "") {
                         DocketNo = row.cells[6].childNodes[0].value;
                         DocketDate = row.cells[7].childNodes[0].value;

                    }

                    if ($('#txtCategory').val() == 'ALL')
                    {
                        //alert(category);
                        var categoryx = row.cells[1].innerText;
                        //alert(categoryx);
                    }

                    tablearray.push({ 'InvoiceNo': InvoiceNo, 'DocketNo': DocketNo, 'DocketDate': DocketDate, 'Category': categoryx })
                }
            }
        }
        //alert(JSON.stringify(tablearray.length));

        if (tablearray.length == 0) {
            alert("Please select Invoice to proceed");

        }
        else {
            var data1 = { 'Invoicedata': tablearray, 'CategoryName': category };
            var data = JSON.stringify(data1);
          //  alert(data);
                $.ajax({
                    url: "/TallySyncronizations/LockInvoiceDocketData",
                    data: data,
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (Data) {

                        alert("Data Updated successfully!");

                      document.location = '@Url.Action("DispatchIntimationEntry", "TallySyncronizations")';


                    },
                    error: function (errormessage) {
                        alert("error");
                        alert(errormessage.responseText);
                    }
                });
            }






    }



    function LoadData(category) {
        $("#tracker-loader").fadeIn("slow");
        $('#txtCategory').val(category);

        $("#flowcheckall").prop('checked', false);

        var Date = $("#txtDate").val();
        var FromDate = $("#txtFromDate").val();
        var BasedOn = document.getElementById('ddlBasedOn').value;
        if (Date == "") {
            alert("Please select date");
        }
        //else if (BasedOn == "2") {
        //    if (FromDate == "") {
        //        alert("Please select from date");
        //    }
        //}
        else {
            if (category == 'ALL') {

                $("#ALL").removeClass("btn btn-primary");
                $("#ALL").addClass("btn btn-success");

                $("#Import,#Bond,#Other,#Domestic,#MNR,#Export").removeClass("btn btn-success");
                $("#Import,#Bond,#Other,#Domestic,#MNR,#Export").addClass("btn btn-primary");

            }

            if (category == 'Import') {

                $("#Import").removeClass("btn btn-primary");
                $("#Import").addClass("btn btn-success");

                $("#ALL,#Bond,#Other,#Domestic,#MNR,#Export").removeClass("btn btn-success");
                $("#ALL,#Bond,#Other,#Domestic,#MNR,#Export").addClass("btn btn-primary");

            }

            if (category == 'Export') {

                $("#Export").removeClass("btn btn-primary");
                $("#Export").addClass("btn btn-success");

                $("#ALL,#Bond,#Other,#Domestic,#MNR,#Import").removeClass("btn btn-success");
                $("#ALL,#Bond,#Other,#Domestic,#MNR,#Import").addClass("btn btn-primary");

            }

            if (category == 'Bond') {

                $("#Bond").removeClass("btn btn-primary");
                $("#Bond").addClass("btn btn-success");

                $("#ALL,#Import,#Other,#Domestic,#MNR,#Export").removeClass("btn btn-success");
                $("#ALL,#Import,#Other,#Domestic,#MNR,#Export").addClass("btn btn-primary");

            }

            if (category == 'Other') {

                $("#Other").removeClass("btn btn-primary");
                $("#Other").addClass("btn btn-success");

                $("#ALL,#Import,#Bond,#Domestic,#MNR,#Export").removeClass("btn btn-success");
                $("#ALL,#Import,#Bond,#Domestic,#MNR,#Export").addClass("btn btn-primary");

            }

            if (category == 'Domestic') {

                $("#Domestic").removeClass("btn btn-primary");
                $("#Domestic").addClass("btn btn-success");

                $("#ALL,#Import,#Bond,#Other,#MNR,#Export").removeClass("btn btn-success");
                $("#ALL,#Import,#Bond,#Other,#MNR,#Export").addClass("btn btn-primary");

            }

            if (category == 'MNR') {

                $("#MNR").removeClass("btn btn-primary");
                $("#MNR").addClass("btn btn-success");

                $("#ALL,#Import,#Bond,#Other,#Domestic,#Export").removeClass("btn btn-success");
                $("#ALL,#Import,#Bond,#Other,#Domestic,#Export").addClass("btn btn-primary");

            }



            var data1 = { 'Date': Date, 'Category': category, 'FromDate': FromDate, 'BasedOn': BasedOn };
            var data = JSON.stringify(data1);

            $.ajax({
                url: "/TallySyncronizations/AjaxPocketFetchCategorywiseInvoice",
                data: data,
                type: "POST",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (Data) {
                    //alert(JSON.stringify(Data));
                    //alert(Data[0].GrandTotal);
                    //var Total = 0;
                    //for (var i = 0; i < Data.length; i++) {
                    //    Total += Data[i].GrandTotal;
                    //}
                    //var SGST = 0;
                    //for (var i = 0; i < Data.length; i++) {
                    //    SGST += Data[i].SGST;
                    //}
                    //var CGST = 0;
                    //for (var i = 0; i < Data.length; i++) {
                    //    CGST += Data[i].CGST;
                    //}
                    //var IGST = 0;
                    //for (var i = 0; i < Data.length; i++) {
                    //    IGST += Data[i].IGST;
                    //}
                    //var TotalGST = +SGST + +CGST + +IGST;
                    $('#txtCount').val(Data.length);
                    //$('#txtSGST').val(SGST);
                    //$('#txtCGST').val(CGST);
                    //$('#txtIGST').val(IGST);
                    //$('#txtTotalGST').val(TotalGST);
                    //$('#txtTotal').val(Total);
                    //alert(Total);
                    $('#tblInvoiceList').dataTable({
                        "destroy": true,
                        "bLengthChange": true,
                        "bInfo": false,
                        "bPaginate": false,
                        "paging": false,
                        //"bFilter": false,
                        "aaSorting": [],
                        "order": [],
                        "aoColumnDefs": [
                            {
                                'bSortable': false,
                                'aTargets': [0]
                            }
                        ],
                        "aaData": Data,
                        "columns": [

                            {
                                "data": "LRno",
                                "render": function (data, type, row, meta) {
                                    if (type === 'display') {

                                        data = '<a   href="#"  class="btn btn-info" data-toggle="modal" data-target="#exampleModalLong" onclick="ShowDoc_View(\'' + row.LRno.replace(/'/g, "\\'") + '\')">View_Docs</i></a>';
                                    }

                                    return data;
                                }


                            },

                              {

                                  "data": "CourierAddress",
                                "render": function (data, type, row, meta) {

                                    data = "<a class=\"btn btn-sm btn-primary\" href=\"#\" id=\"getattachmentid\" onclick=\"GetAddress(" +row.CourierAddress +")\"> Courier Address</a>";
                                      return data;

                                  }
                              },
                            {

                                "data": "Select",
                                "render": function (data, type, row, meta) {

                                    data = '<input type=\"checkbox\" name=\"checklist[]\" class=\"checklist\" id=\"checklist\"  value="' + row.InvoiceNo + '">';
                                    return data;

                                }
                            },
                            { "data": "Category" },
                            { "data": "InvoiceNo" },
                            { "data": "InvoiceDate1" },
                            {
                                "data": "data",
                                "render": function (data, type, row, meta) {

                                    data = '<input type=\"text\" name=\"Docketno[]\" class=\" form-control Docketno\" id=\"Docketno\"  value="' + row.DocketNo + '">';
                                    return data;
                                }
                            },

                            {
                                "data": "data",
                                "render": function (data, type, row, meta) {

                                    data = '<input type=\"Date\" name=\"DocketDate[]\" class=\" form-control DocketDate\" id=\"DocketDate\"  value="' + row.DocketDate + '">';
                                    return data;
                                }
                            },
                           // { "data": "DocketNo" },
                            //{ "data": "DocketDate" },
                           // { "data": "GSTNo" },
                            { "data": "GSTName" },
                            { "data": "ChaName" },
                            //{ "data": "State" },
                            //{ "data": "CGST" },
                            //{ "data": "IGST" },
                            { "data": "TotalGST" },
                            { "data": "GrandTotal" },
                           // { "data": "WorkYear" }







                        ]
                        //,
                        //"dom": 'Bfrtip',
                        //"buttons": [{
                        //    "extend": 'excel',
                        //    "title": 'CategoryWiseInvoice',
                        //    "filename": 'CategoryWiseInvoice',
                        //    "text":'Export to Excel'

                        //}

                        //]

                    })


                    $("#tracker-loader").fadeOut("slow");

                },
                error: function (errormessage) {
                    alert("error");
                    alert(errormessage.responseText);
                    $("#tracker-loader").fadeOut("slow");
                }
            });

            $("#global-loader").css("display", "none");
        }

    }



    function GetAddress(CourierAddress) {

        if (CourierAddress != null) {

            var data1 = { 'CourierID': CourierAddress };
            var data = JSON.stringify(data1);
            $.ajax({
                url: "/TallySyncronizations/CourierAddressPrint",
                data: data,
                type: "POST",
                contentType: "application/json; charset=utf-8",
              //  dataType: "json",
                success: function (response) {

                    var myWindow = window.open("", "MsgWindow1");
                    myWindow.close();
                    var myWindow = window.open("", "MsgWindow1");
                    myWindow.document.write(response);

                },
                error: function (errormessage) {
                    alert("error");
                    alert(errormessage.responseText);

                }
            });

        }else{
            alert("There is no Courier Address");
            return false
        }


    }


    function ShowDoc_View(LRno) {
        var data = { 'LRno': LRno };
        data = JSON.stringify(data);
        $.ajax({
            url: "/TallySyncronizations/AjaxLRcontainerList",
            data: data,
            type: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (Data) {
                //alert(Data);
                $('#example').dataTable({
                    "destroy": true,
                    "bLengthChange": true,
                    "bInfo": false,
                    "bPaginate": false,
                    "paging": false,
                    //"bFilter": false,
                    "aaSorting": [],



                    "aaData": Data,
                    "columns": [

                        { "data": "LRno" },
                    ]


                })




            },
            error: function (errormessage) {
                alert("error");
                alert(errormessage.responseText);

            }
        });
    }

    $(document).ready(function () {

        $('#tblInvoiceList').dataTable({
            "bLengthChange": false,
            "bInfo": false,
            "bPaginate": true,
            //"bFilter": false,
            "paging": true,
            "order": [],
            "aoColumnDefs": [
                {
                    'bSortable': false,
                    'aTargets': [0]
                }

            ]


        })


        $('#tblExport').dataTable({
            "bLengthChange": false,
            "bInfo": false,
            "bPaginate": false,
            "bFilter": false,
            "paging": false,
            "order": [],
            "aoColumnDefs": [
                {
                    'bSortable': false,
                    'aTargets': [0]
                }

            ]


        })



        $(function () {

            $('.datePicker1').datepicker({
                autoclose: true,
                todayHighlight: true,
                format: 'dd M yyyy',
                language: "tr",
                changeMonth: true,
                changeYear: true

            })
                .on('changeDate', function (e) {

                    $('.datepicker').hide();
                });
        });

        $("#tracker-loader").fadeOut("slow");
    });
                </script>

